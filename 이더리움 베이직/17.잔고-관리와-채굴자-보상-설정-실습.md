# ìž”ê³  ê´€ë¦¬ì™€ ì±„êµ´ìž ë³´ìƒ ì„¤ì • ì‹¤ìŠµ

> ê°€ì œ: UTXO ì‹¤ìŠµ.

## ë“¤ì–´ê°€ë©°

ë¸”ë¡ì²´ì¸ ë„¤íŠ¸ì›Œí¬ëŠ” íŠ¸ëžœìž­ì…˜ì„ í†µí•´ ìƒíƒœë¥¼ ë³€ê²½í•˜ê³  ìž”ê³ ë¥¼ ì¶”ì í•©ë‹ˆë‹¤.
ì´ì „ ëª¨ë“ˆì—ì„œ íŠ¸ëžœìž­ì…˜ ì¶œë ¥(TXO)ê³¼ ì‚¬ìš©ëœ TXOì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ë‹¤ë©´, ì´ë²ˆ ëª¨ë“ˆì—ì„œëŠ” íŠ¸ëžœìž­ì…˜ì„ í•  ë•Œì˜ ê¸ˆì•¡ê³¼ ìž”ê³  í™•ì¸, íŠ¸ëžœìž­ì…˜ ì„±ê³µ, ì±„êµ´ìž ë³´ìƒ ì„¤ì •ê¹Œì§€ ì½”ë“œë¥¼ ìž‘ì„±í•˜ë©´ì„œ í•¨ê»˜ ì‚´íŽ´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

## ì‚¬ì „ ì¤€ë¹„

ì´ë²ˆ ì‹¤ìŠµì—ì„œëŠ” CodeSandboxë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

ë¨¼ì €, [ë§í¬](http://??)ë¥¼ í´ë¦­í•˜ì—¬ CodeSandbox íŽ˜ì´ì§€ë¡œ ì´ë™í•´ì£¼ì„¸ìš”.

í™”ë©´ ìš°ì¸¡ ìƒë‹¨ì— ìžˆëŠ” [Sign In] ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë¡œê·¸ì¸ì„ í•©ë‹ˆë‹¤.

TODO: ì‚¬ì§„ ì¶”ê°€

ë¡œê·¸ì¸ì´ ì™„ë£Œë˜ë©´, ì œê³µëœ ì½”ë“œë¥¼ CodeSandboxì—ì„œ ìžì‹ ì˜ í”„ë¡œì íŠ¸ë¡œ ë³µì œí•´ì¤ë‹ˆë‹¤.

ê·¸ëŸ¼ ì´ì œë¶€í„°ëŠ” ìžìœ ë¡­ê²Œ ì½”ë“œë¥¼ ìˆ˜ì •í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

## ì‹¤ìŠµ 1. ê¸ˆì•¡ê³¼ ìž”ê³  í™•ì¸

> **ì‹¤ìŠµ ëª©í‘œ:**
>
> ìž…ë ¥ UTXOì˜ ì´í•©ì´ ì¶œë ¥ UTXOì˜ ì´í•©ì„ ì¶©ë‹¹í•  ìˆ˜ ìžˆëŠ”ì§€ í™•ì¸í•˜ê³ , ìž…ë ¥ì˜ ì´í•©ì´ ì¶œë ¥ì˜ ì´í•©ë³´ë‹¤ ìž‘ìœ¼ë©´ ì‹¤í–‰ í•¨ìˆ˜ì—ì„œ ì—ëŸ¬ë¥¼ ë˜ì§‘ë‹ˆë‹¤.

ë¹„íŠ¸ì½”ì¸ ì§€ê°‘ ì†Œí”„íŠ¸ì›¨ì–´ëŠ” ë•Œë•Œë¡œ í•˜ë‚˜ì˜ í° UTXOë¡œ í•©ì³ ì†Œìœ ìžì—ê²Œ ë‹¤ì‹œ ë³´ë‚´ê¸° ìœ„í•´ ë§Žì€ ìž…ë ¥ UTXOë¥¼ í¬í•¨í•˜ë„ë¡ ì„ íƒí•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ê°ê° 0.1 BTCì˜ ê¸ˆì•¡ì„ ê°€ì§„ 5ê°œì˜ UTXOê°€ ìžˆë‹¤ë©´ ì§€ê°‘ì€ ë‹¤ìŒ ê±°ëž˜ì—ì„œ ì´ë¥¼ 0.5 BTCë¡œ í•©ì¹˜ë„ë¡ ì„ íƒí•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

ë•Œë¬¸ì— ìž…ë ¥ UTXOì˜ ì´ ê°€ì¹˜ê°€ ì¶œë ¥ UTXOì˜ ì´ ê¸ˆì•¡ì„ ì¶©ë‹¹í•  ìˆ˜ ìžˆì„ ë§Œí¼ ì¶©ë¶„í•œì§€ í™•ì¸í•˜ëŠ” ê²ƒì´ ê°€ìž¥ ì¤‘ìš”í•©ë‹ˆë‹¤.

### 1ë‹¨ê³„: ì½”ë“œ ìž‘ì„±

### 2ë‹¨ê³„: í…ŒìŠ¤íŠ¸

```javascript
// Transaction.js
class Transaction {
  constructor(inputUTXOs, outputUTXOs) {
    this.transactions = { inputUTXOs, outputUTXOs };
  }
  execute() {
    const isDoubleSpend = this.transactions.inputUTXOs.findIndex((utxo) => utxo.spent === true);

    if (isDoubleSpend !== -1) {
      throw new Error('input TXO is already spent.');
    }

    const totalInputAmount = this.transactions.inputUTXOs.reduce((acc, cur) => acc + cur.amount, 0);
    const totalOutputAmount = this.transactions.outputUTXOs.reduce((acc, cur) => acc + cur.amount, 0);

    if (totalInputAmount < totalOutputAmount) {
      throw new Error('insufficient amount: total value of the inputs is less than the total value of the outputs!');
    }
  }
}

module.exports = Transaction;
```

## ì‹¤ìŠµ 2. íŠ¸ëžœìž­ì…˜ ì„±ê³µ

> **ì‹¤ìŠµ ëª©í‘œ:**
>
> í˜¸í˜¸

íŠ¸ëžœìž­ì…˜ì´ ì„±ê³µí•˜ì—¬ ë¸”ë¡ì²´ì¸ì— ì±„êµ´ë˜ë©´, ì¶œë ¥ UTXOëŠ” ì‚¬ìš©í•  ì¤€ë¹„ê°€ ëœ ìƒˆë¡œìš´ TXOê°€ ë©ë‹ˆë‹¤.

ìž…ë ¥ëœ UTXOëŠ” ë‹¤ì‹œ ì‚¬ìš©ë˜ì§€ ì•Šë„ë¡ ì‚¬ìš©ë¨ìœ¼ë¡œ í‘œì‹œí•´ì•¼ í•©ë‹ˆë‹¤!

ê²°êµ­ ë¸”ë¡ì²´ì¸ì˜ ì „ì²´ ëª©ì ì€ ì´ì¤‘ ì§€ì¶œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ê²ƒìž…ë‹ˆë‹¤ ðŸ˜‰.

```javascript
class Transaction {
  constructor(inputUTXOs, outputUTXOs) {
    this.transactions = { inputUTXOs, outputUTXOs };
  }
  execute() {
    const isDoubleSpend = this.transactions.inputUTXOs.findIndex((utxo) => utxo.spent === true);

    if (isDoubleSpend !== -1) {
      throw new Error('input TXO is already spent.');
    }

    const prevInputUTXOs = [...this.transactions.inputUTXOs];
    const prevOutputUTXOs = [...this.transactions.outputUTXOs];

    const totalInputAmount = prevInputUTXOs.reduce((acc, cur) => acc + cur.amount, 0);
    const totalOutputAmount = prevOutputUTXOs.reduce((acc, cur) => acc + cur.amount, 0);

    if (totalInputAmount < totalOutputAmount) {
      throw new Error('insufficient amount!');
    }

    const newInputUTXOs = prevInputUTXOs.map((utxo) => (utxo.spent = true));

    this.transactions.inputUTXOs = newInputUTXOs;
  }
}

module.exports = Transaction;
```

## ì‹¤ìŠµ 3. ì±„êµ´ìž ë³´ìƒ ì„¤ì •

> **ì‹¤ìŠµ ëª©í‘œ:**
>
> ë¸”ë¼ë¸”ë¼

ì´ì¯¤ ë˜ë©´ ì™œ ì„¸ ë²ˆì§¸ ë‹¨ê³„ì—ì„œ ì´ ìž…ë ¥ ê¸ˆì•¡ì´ ì´ ì¶œë ¥ ê¸ˆì•¡ë³´ë‹¤ ë§Žì•„ì•¼ë§Œ í•˜ëŠ”ì§€ ê¶ê¸ˆí•˜ì‹¤ í…ë°ìš”.

ì¶œë ¥ ê¸ˆì•¡ì´ ë” ì ìœ¼ë©´ ì˜¤ë¥˜ë¥¼ ë˜ì ¸ì•¼ í•˜ì§€ ì•Šì„ê¹Œìš”? ðŸ¤”

ì•„ë‹™ë‹ˆë‹¤! ì‚¬ì‹¤, ë‚˜ë¨¸ì§€ëŠ” ì±„êµ´ìžì—ê²Œ ì£¼ì–´ì§‘ë‹ˆë‹¤! â›ï¸

ì´ê²ƒì€ ë¹„íŠ¸ì½”ì¸ ì‹œìŠ¤í…œì˜ ì„¤ê³„ìƒ ì„ íƒìž…ë‹ˆë‹¤.

íŠ¸ëžœìž­ì…˜ ìˆ˜ìˆ˜ë£Œë¼ê³  í•˜ë©°, íŠ¸ëžœìž­ì…˜ ìˆ˜ìˆ˜ë£ŒëŠ” ìš”ì²­ì„ ì‹ ì†í•˜ê²Œ ì²˜ë¦¬í•˜ëŠ” ë° ë„ì›€ì´ ë  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

ì±„êµ´ìžê°€ ìˆ˜ì§‘í•  ìˆ˜ ìžˆëŠ” í° ìƒê¸ˆì„ í¬í•¨í•˜ë©´ ë‹¤ìŒ ë¸”ë¡ì— íŠ¸ëžœìž­ì…˜ì„ í¬í•¨í•  ê°€ëŠ¥ì„±ì´ í›¨ì”¬ ë” ë†’ì•„ì§‘ë‹ˆë‹¤! ðŸ’°

> ðŸ“– ì°¸ê³  ì‚¬í•­
>
> ë¹„íŠ¸ì½”ì¸ì€ [ê³µê¸‰ì´ í†µì œ](https://en.bitcoin.it/wiki/Controlled_supply)ë©ë‹ˆë‹¤.
> ì œí•œëœ ì‹œê°„ ë™ì•ˆ ëª¨ë“  ë¸”ë¡ì—ì„œ ì±„êµ´ìžì—ê²Œ ë³´ìƒì´ ì£¼ì–´ì§‘ë‹ˆë‹¤.
> íŠ¹ì • ì‹œì ì´ ë˜ë©´ ì´ ë³´ìƒì€ ì¤‘ë‹¨ë˜ê³  ì±„êµ´ìžì—ê²Œ ì£¼ì–´ì§€ëŠ” ìœ ì¼í•œ ë³´ìƒì€ ê±°ëž˜ ìˆ˜ìˆ˜ë£Œê°€ ë©ë‹ˆë‹¤.

`execute` í•¨ìˆ˜ê°€ ëë‚˜ë©´ ìˆ˜ìˆ˜ë£Œë¥¼ ëª¨ë“  ìž…ë ¥ê°’ì˜ í•©ê³„ì—ì„œ ëª¨ë“  ì¶œë ¥ê°’ì˜ í•©ê³„ë¥¼ ëº€ ê°’ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤.
ìž…ë ¥ê°’ì´ ë¶€ì¡±í•˜ë©´ ì—ëŸ¬ê°€ ë°œìƒí•˜ë¯€ë¡œ ì´ ê°’ì€ ìµœì†Œ 0ì´ì–´ì•¼ í•©ë‹ˆë‹¤.
ì¶œë ¥ì´ ë” ì ì„ ë•ŒëŠ” ì–‘ìˆ˜ ìˆ˜ìˆ˜ë£Œê°€ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
ìˆ˜ìˆ˜ë£Œ ê¸ˆì•¡ì€ íŠ¸ëžœìž­ì…˜ì˜ ìˆ˜ìˆ˜ë£Œë¼ëŠ” í”„ë¡œí¼í‹°ì— ì €ìž¥í•©ë‹ˆë‹¤.

ì˜ˆì‹œ:

```javascript
const iTXO = new TXO(fromAddress, 5);
const oTXO = new TXO(toAddress, 3);

const tx = new Transaction([iTXO], [oTXO]);

tx.execute();

console.log(tx.fee); // 2
```

```javascript
class Transaction {
  constructor(inputUTXOs, outputUTXOs) {
    this.transactions = { inputUTXOs, outputUTXOs };
    this.fee = 0;
  }
  execute() {
    const isDoubleSpend = this.transactions.inputUTXOs.findIndex((utxo) => utxo.spent === true);

    if (isDoubleSpend !== -1) {
      throw new Error('input TXO is already spent.');
    }

    const prevInputUTXOs = [...this.transactions.inputUTXOs];
    const prevOutputUTXOs = [...this.transactions.outputUTXOs];

    const totalInputAmount = prevInputUTXOs.reduce((acc, cur) => acc + cur.amount, 0);
    const totalOutputAmount = prevOutputUTXOs.reduce((acc, cur) => acc + cur.amount, 0);

    if (totalInputAmount < totalOutputAmount) {
      throw new Error('insufficient amount!');
    }

    this.fee = totalInputAmount - totalOutputAmount;

    const newInputUTXOs = prevInputUTXOs.map((utxo) => (utxo.spent = true));

    this.transactions.inputUTXOs = newInputUTXOs;
  }
}

module.exports = Transaction;
```

## ë‚˜ê°€ë©°
